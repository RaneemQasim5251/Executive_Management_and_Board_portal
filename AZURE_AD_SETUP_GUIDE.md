# Azure AD App Registration Setup Guide

## ðŸŽ¯ Your App Details
- **Client ID**: `ab13106b-99f4-416d-aa53-a0ca9d3175ca`
- **Tenant ID**: `ba2cab20-721a-44f0-bec4-f2e784ba3c23`

## ðŸ”§ Step-by-Step Setup

### Step 1: Access Azure Portal
1. Go to [Azure Portal](https://portal.azure.com)
2. Sign in with your admin account
3. Navigate to **Azure Active Directory**
4. Click **App registrations**
5. Find your app with Client ID: `ab13106b-99f4-416d-aa53-a0ca9d3175ca`

### Step 2: Configure API Permissions
1. In your app registration, click **API permissions**
2. Click **Add a permission**
3. Select **Power BI Service**
4. Choose **Application permissions** (NOT Delegated permissions)
5. Select the following permissions:
   - âœ… `Dataset.Read.All`
   - âœ… `Dataset.ReadWrite.All`
   - âœ… `Report.Read.All`
   - âœ… `Report.ReadWrite.All`
   - âœ… `Workspace.Read.All`
   - âœ… `Content.Create`
   - âœ… `App.Read.All`

6. Click **Add permissions**
7. **IMPORTANT**: Click **Grant admin consent for [Your Organization]**
8. Wait for the green checkmarks to appear

### Step 3: Verify Client Secret
1. Go to **Certificates & secrets**
2. Check if your client secret is still valid (not expired)
3. If expired, create a new secret:
   - Click **New client secret**
   - Add description: "Power BI Integration"
   - Set expiration: 24 months (recommended)
   - Copy the new secret value immediately

### Step 4: Configure Authentication
1. Go to **Authentication**
2. Under **Advanced settings**:
   - Set **Allow public client flows** to **No**
   - This is correct for service principal authentication

### Step 5: Enable Power BI Service Principal
1. Go to [Power BI Admin Portal](https://app.powerbi.com/admin-portal/tenantSettings)
2. Under **Developer settings**:
   - Enable **Embed content in apps**
   - Enable **Allow service principals to use Power BI APIs**
   - Add your app's Client ID to the security group or enable for entire organization

## ðŸ§ª Testing Your Setup

### Test 1: Basic Azure AD Connection
```bash
node test-azure-connection.js
```

### Test 2: Power BI Token Generation
```bash
node get-powerbi-token.js
```

## ðŸ” Common Issues and Solutions

### Issue: `invalid_client` Error
**Cause**: Client ID or Secret is wrong
**Solutions**:
- Verify Client ID matches exactly
- Check if Client Secret is expired
- Generate new Client Secret if needed

### Issue: `unauthorized_client` Error
**Cause**: App doesn't have permission for client credentials flow
**Solutions**:
- Use **Application permissions**, not Delegated
- Grant admin consent
- Wait 5-10 minutes for propagation

### Issue: `invalid_scope` Error
**Cause**: Power BI API permissions not configured
**Solutions**:
- Add Power BI Service API permissions
- Grant admin consent
- Enable service principal in Power BI Admin Portal

## âœ… Success Indicators

When everything is configured correctly, you should see:
- âœ… Green checkmarks next to all API permissions
- âœ… "Granted for [Organization]" status
- âœ… Valid access token generated by test scripts
- âœ… No 400/401 errors in token requests

## ðŸ”’ Security Best Practices

1. **Use Application Permissions**: Never use Delegated permissions for service accounts
2. **Rotate Secrets**: Update client secrets every 12-24 months
3. **Principle of Least Privilege**: Only grant necessary permissions
4. **Monitor Usage**: Regular audit of API calls and permissions
5. **Secure Storage**: Never commit secrets to source control

## ðŸ“ž Support

If you continue to have issues:
1. Check Azure AD logs: Azure Portal > Azure Active Directory > Sign-in logs
2. Verify Power BI service principal settings
3. Ensure you have Global Administrator or Power BI Administrator rights
4. Contact your IT administrator for help with tenant-level permissions